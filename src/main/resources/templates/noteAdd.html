<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Notion Clone</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100">
<div class="flex h-screen">
  <!-- μ‚¬μ΄λ“λ°” -->
  <div class="w-64 bg-white p-4 shadow-md">
    <h2 class="text-lg font-bold mb-4">My Notion</h2>
    <ul>
      <li class="py-2 px-3 hover:bg-gray-200 rounded cursor-pointer">
        <a href="/home" class="block w-full h-full">Home</a>
      </li>
      <li class="py-2 px-3 hover:bg-gray-200 rounded cursor-pointer relative" onmouseover="showAddButton('noteAddBtn')" onmouseout="hideAddButton('noteAddBtn')">
        <a href="/note" class="block w-full h-full">Notes</a>
        <!-- Notes ν•­λ©μ— + λ²„νΌ μ¶”κ°€ -->
        <form action='/note/create' method="post">
        <button id="noteAddBtn" class="absolute top-1 right-1 bg-blue-500 text-white p-1 rounded-full hidden" onclick="createNote()">+</button>
        </form>
      </li>
      <li class="py-2 px-3 hover:bg-gray-200 rounded cursor-pointer relative" onmouseover="showAddButton('taskAddBtn')" onmouseout="hideAddButton('taskAddBtn')">
        <a href="/task" class="block w-full h-full">Tasks</a>
        <!-- Tasks ν•­λ©μ— + λ²„νΌ μ¶”κ°€ -->
        <button id="taskAddBtn" class="absolute top-1 right-1 bg-blue-500 text-white p-1 rounded-full hidden" onclick="showTaskInput()">+</button>
      </li>
    </ul>
  </div>

  <!-- λ©”μΈ μ½ν…μΈ  -->
  <div class="flex-1 p-6">
    <h1 class="text-2xl font-bold mb-4">Notion ν΄λ΅ μ— μ¤μ‹  κ²ƒμ„ ν™μν•©λ‹λ‹¤</h1>

    <!-- λ…ΈνΈ λ©λ΅ -->
    <div class="p-4 bg-white rounded shadow-md" id="noteSection">
      <h2 class="text-lg font-semibold">π“ λ…ΈνΈ λ©λ΅</h2>
      <ul id="noteContainer" class="mt-2 space-y-2"></ul>
    </div>

    <!-- λ…ΈνΈ μ‘μ„± μ„Ήμ… -->
    <div id="noteInputSection" class="p-4 bg-white rounded shadow-md mt-6 hidden">
      <h2 class="text-lg font-semibold">π“ μƒ λ…ΈνΈ μ‘μ„±</h2>
      <textarea id="noteInput" class="w-full p-2 border rounded mt-2" placeholder="μƒλ΅μ΄ λ…ΈνΈλ¥Ό μ‘μ„±ν•μ„Έμ”..."></textarea>
      <button onclick="addNote()" class="mt-2 px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">μ‘μ„±</button>
    </div>

    <!-- λ“κΈ€ μ„Ήμ… -->
    <div id="commentSection" class="p-4 bg-white rounded shadow-md mt-6 hidden">
      <h2 class="text-lg font-semibold">π’¬ λ“κΈ€</h2>
      <div class="space-y-4 mt-4" id="commentsContainer"></div>
      <div class="flex mt-4">
        <input id="commentInput" class="w-full p-2 border rounded-l-md text-sm" placeholder="λ“κΈ€μ„ μ‘μ„±ν•μ„Έμ”..." onkeypress="handleCommentInput(event)" />
      </div>
    </div>
  </div>
</div>


<script>
  // λ…ΈνΈ μ¶”κ°€ λ²„νΌ ν‘μ‹
  function showAddButton(id) {
    document.getElementById(id).classList.remove("hidden");
  }

  // λ…ΈνΈ μ¶”κ°€ λ²„νΌ μ¨κΈ°κΈ°
  function hideAddButton(id) {
    document.getElementById(id).classList.add("hidden");
  }

  // λ…ΈνΈ μ‘μ„± μ…λ ¥μ°½ ν‘μ‹
  function showNoteInput() {
    document.getElementById("noteInputSection").classList.remove("hidden");
  }

  // λ…ΈνΈ μ¶”κ°€ κΈ°λ¥
  function addNote() {
    let noteInput = document.getElementById("noteInput");
    let noteContainer = document.getElementById("noteContainer");
    let noteText = noteInput.value.trim();

    if (noteText === "") return;

    let li = document.createElement("li");
    li.className = "p-4 bg-white rounded shadow flex justify-between items-center cursor-pointer";
    li.onclick = function () {
      document.getElementById("commentSection").classList.remove("hidden");
    };

    let span = document.createElement("span");
    span.textContent = noteText;
    span.className = "flex-1 text-gray-800";

    let menuBtn = document.createElement("button");
    menuBtn.textContent = "β‹®";
    menuBtn.className = "text-gray-500 ml-2 hover:text-gray-700";
    menuBtn.onclick = function (event) {
      event.stopPropagation();
      let newText = prompt("μμ •ν•  λ‚΄μ©μ„ μ…λ ¥ν•μ„Έμ”", span.textContent);
      if (newText !== null && newText.trim() !== "") {
        span.textContent = newText;
      }
    };

    let deleteBtn = document.createElement("button");
    deleteBtn.textContent = "β•";
    deleteBtn.className = "text-red-500 ml-2 hover:text-red-700";
    deleteBtn.onclick = function (event) {
      event.stopPropagation();
      noteContainer.removeChild(li);
    };

    li.appendChild(span);
    li.appendChild(menuBtn);
    li.appendChild(deleteBtn);
    noteContainer.appendChild(li);

    noteInput.value = "";
    document.getElementById("noteInputSection").classList.add("hidden");
  }

  function handleCommentInput(event) {
    let commentInput = document.getElementById("commentInput");
    if (event.key === "Enter" && commentInput.value.trim() !== "") {
      addComment(commentInput.value);
      commentInput.value = "";
    }
  }

  function addComment(commentText) {
    let commentsContainer = document.getElementById("commentsContainer");
    let li = document.createElement("li");
    li.className = "p-4 bg-gray-200 rounded-lg shadow flex justify-between items-center";

    let span = document.createElement("span");
    span.textContent = commentText;
    span.className = "flex-1 cursor-pointer text-gray-800";

    let deleteBtn = document.createElement("button");
    deleteBtn.textContent = "β•";
    deleteBtn.className = "text-red-500 ml-2 hover:text-red-700";
    deleteBtn.onclick = function () {
      commentsContainer.removeChild(li);
    };

    li.appendChild(span);
    li.appendChild(deleteBtn);
    commentsContainer.appendChild(li);
  }

  function createNote() {
    fetch('/note/create', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({ content: 'μƒλ΅μ΄ λ…ΈνΈ', username: 'User'
      }) // ν•„μ”ν•λ©΄ λ°μ΄ν„° μ¶”κ°€
    })
            .then(response => {
              if (!response.ok) {
                throw new Error('λ…ΈνΈ μƒμ„± μ‹¤ν¨');
              }
              return response.json(); // μ„λ²„κ°€ JSON μ‘λ‹µμ„ μ¤€λ‹¤λ©΄
            })
            .then(data => {
              console.log('λ…ΈνΈ μƒμ„± μ„±κ³µ:', data);
              alert('λ…ΈνΈκ°€ μƒμ„±λμ—μµλ‹λ‹¤!');
              location.reload(); // νμ΄μ§€ μƒλ΅κ³ μΉ¨ or λ‹¤λ¥Έ νμ΄μ§€ μ΄λ™
            })
            .catch(error => {
              console.error('μ¤λ¥ λ°μƒ:', error);
              alert('λ…ΈνΈ μƒμ„±μ— μ‹¤ν¨ν–μµλ‹λ‹¤.');
            });
  }
</script>
</body>
</html>
